# #############################
# Definition of SW infrastructure for the Angular app
# Defines:
# - services
# - networks
# - volumes
# Uses profiles to control what configurations launch, depending on the user-scenario
# ##############################
version: "3.8"

networks:
  backnet:
    name: backnet

services:
  # #######################
  # Backend nest service
  # - Prerequisite: image exists.
  # #######################
  nestserver:
    image: sergiunb/dashboards-nest
    working_dir: /home/node/app/dashboards
    container_name: findash-dashboards-serv
    environment:
      - NODE_ENV=dev
      - ENV_LOCATION=./environments
      - DB_HOST='datastore-server'
      - DB_PORT=3306
      - DB_USER='root'
      - DB_PASS='root'
      - DB_NAME=dashboards.sqlite
      - DB_TYPE=sqlite
      - DB_SYNC_FLAG=true

    volumes:
      - "../app:/home/node/app"
    networks:
      backnet:
        aliases:
          - dashboards-server
    ports:
      - "5000:3000"
    # Note: hot-reload is enabled by default
    command: ["sh", "-c", "npm run start:dev --port 3000 --host 0.0.0.0"]
 
    profiles: ["dev", "test"]
